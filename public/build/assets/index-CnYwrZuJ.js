import{A as g}from"./AppLayout-C2fcH5kv.js";import{D as M}from"./DataTable-Err4qTG9.js";import{a as n,J as m,o as c,e as v,w as h,f as e,g as k,i as p,E as w,q as y,C as i,F as x,x as C,j as I,K as S,O as A,P as D}from"./index-QC1Cz5ZB.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SideNavBar-Do_6nNue.js";const R={components:{AppLayout:g,DataTable:M},data(){return{columns:[{data:"check",name:"check",orderable:!1,searchable:!1},{data:"name",name:"name",orderable:!0,searchable:!0},{data:"email",name:"email",orderable:!1,searchable:!1},{data:"subject",name:"subject",orderable:!1,searchable:!1},{data:"message",name:"message",orderable:!1,searchable:!1},{data:"date",name:"date",orderable:!0,searchable:!1},{data:"action",name:"action",render(t,s,d){return`
                            <button class="btn btn-primary btn-sm action_reply" data-id="${d.id}">Reply</button>
                            <button class="btn btn-danger btn-sm action_delete" data-id="${d.id}">Delete</button>
                        `},orderable:!1,searchable:!1}],replyMessage:"",selectedMessageId:null,chatHistory:[]}},mounted(){const t=this;$("#mytable tbody").on("click",".action_reply",function(){const s=$(this).data("id");t.openModal(s)}),$("#mytable tbody").on("click",".action_delete",function(){const s=$(this).data("id");confirm("Are you sure you want to delete this message?")&&t.deleteMessage(s)})},methods:{openModal(t){this.selectedMessageId=t,this.fetchChatHistory(),$("#replyModal").modal("show")},closeModal(){$("#replyModal").modal("hide"),this.replyMessage="",this.chatHistory=[],this.selectedMessageId=null},async fetchChatHistory(){try{const t=await n.get(`/contact-hr/chat-history/${this.selectedMessageId}`),{chat_history:s=[],employee_message:d,created_at:u}=t.data;this.chatHistory=[...s.map(l=>({message:l.message,timestamp:l.timestamp||new Date().toISOString(),from:l.from||"admin"}))]}catch(t){console.error("Failed to fetch chat history:",t),alert("Failed to load chat history.")}},async sendReply(){if(!this.replyMessage.trim()){alert("Reply cannot be empty.");return}try{await n.post(route("contact.hr.reply",this.selectedMessageId),{reply:this.replyMessage}),this.chatHistory.push({message:this.replyMessage,timestamp:new Date().toISOString(),from:"admin"}),this.replyMessage="",alert("Reply sent successfully.")}catch(t){console.error("Failed to send reply:",t),alert("Failed to send reply. Please try again.")}},async deleteMessage(t){try{await n.delete(`/contact-hr/${t}`),alert("Message deleted successfully."),this.location.reload()}catch(s){console.error("Failed to delete message:",s),this.location.reload()}}}},o=t=>(A("data-v-726f07bf"),t=t(),D(),t),F={class:"row"},L={class:"col-md-12"},j={class:"card mb-4"},E=o(()=>e("div",{class:"card-header pb-0"},[e("h5",{style:{"font-size":"1.1rem",color:"#495057"}},"Contact HR Management"),e("p",{class:"mb-0",style:{"font-size":"0.89rem"}},"Manage Contact HR Messages.")],-1)),z={class:"card-body"},B={width:"10%"},N={class:"custom-control custom-checkbox"},O=o(()=>e("label",{class:"form-check-label",for:"selectAll"},null,-1)),T=o(()=>e("th",null,"Name",-1)),V=o(()=>e("th",null,"Email",-1)),q=o(()=>e("th",null,"Subject",-1)),P=o(()=>e("th",null,"Message",-1)),J=o(()=>e("th",null,"Date",-1)),K=o(()=>e("th",null,"Action",-1)),U={class:"modal fade",id:"replyModal",tabindex:"-1","aria-labelledby":"replyModalLabel","aria-hidden":"true"},Y={class:"modal-dialog"},G={class:"modal-content"},Q={class:"modal-header"},W=o(()=>e("h5",{class:"modal-title",id:"replyModalLabel"},"Chat with Employee",-1)),X={class:"modal-body"},Z={class:"chat-history"},ee={style:{background:"#f8f9fa",padding:"10px","border-radius":"8px"}},te={style:{"font-size":"0.8rem",color:"gray"}},se={class:"form-group mt-3"},ae={class:"d-flex justify-content-end mt-3"},oe=o(()=>e("button",{type:"submit",class:"btn btn-primary"},"Send Reply",-1));function le(t,s,d,u,l,r){const b=m("data-table"),_=m("AppLayout");return c(),v(_,null,{default:h(()=>[e("div",F,[e("div",L,[e("div",j,[E,e("div",z,[k(b,{ref:"datatable",id:"mytable",url:t.route("contact.hr.getdata"),columns:l.columns},{header:h(()=>[e("tr",null,[e("th",B,[e("div",N,[e("input",{type:"checkbox",class:"form-check-input",id:"selectAll",onClick:s[0]||(s[0]=a=>t.selectAll(a))}),O])]),T,V,q,P,J,K])]),_:1},8,["url","columns"])])])]),e("div",U,[e("div",Y,[e("div",G,[e("div",Q,[W,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[1]||(s[1]=(...a)=>r.closeModal&&r.closeModal(...a))})]),e("div",X,[e("div",Z,[(c(!0),p(x,null,w(l.chatHistory,(a,f)=>(c(),p("div",{key:f},[e("div",{class:y(a.from==="admin"?"text-start":"text-end")},[e("span",{class:y(a.from==="admin"?"badge bg-primary":"badge bg-secondary")},i(a.from==="admin"?"You":"Employee"),3),e("p",ee,i(a.message),1),e("small",te,i(new Date(a.timestamp).toLocaleString()),1)],2)]))),128))]),e("form",{onSubmit:s[4]||(s[4]=C((...a)=>r.sendReply&&r.sendReply(...a),["prevent"]))},[e("div",se,[I(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=a=>l.replyMessage=a),class:"form-control",rows:"3",placeholder:"Type your reply...",required:""},null,512),[[S,l.replyMessage]])]),e("div",ae,[e("button",{type:"button",class:"btn btn-secondary me-2",onClick:s[3]||(s[3]=(...a)=>r.closeModal&&r.closeModal(...a))}," Cancel "),oe])],32)])])])])])]),_:1})}const me=H(R,[["render",le],["__scopeId","data-v-726f07bf"]]);export{me as default};
