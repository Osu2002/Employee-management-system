import{A as C}from"./AppLayout-68SlFB6E.js";import{D as x,a as _,J as w,o as n,e as S,w as k,f as e,x as g,j as m,K as h,i,E as f,C as d,F as y,s as p,q as v,O as I,P as E,G as j}from"./index-QC1Cz5ZB.js";import{S as u}from"./sweetalert2.all-R2NmH7ql.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SideNavBar-Do_6nNue.js";const D={components:{AppLayout:C},props:{},data(){return{allMessages:"",showModal:!0,form:x({name:this.$page.props.employee.name,email:this.$page.props.employee.email,subject:"",message:""}),messages:[],selectedMessageId:null,selectedChat:"",formattedChat:[],replyMessage:"",loading:!1}},mounted(){this.fetchAllMessages(),this.reloadChat()},methods:{async fetchAllMessages(){try{const t=await _.get(route("contact.hr"));console.log(t),this.allMessages=t.data}catch(t){console.error("Error fetching messages:",t)}},reloadChat(){this.interval=setInterval(()=>{this.fetchAllMessages(),this.selectedMessageId&&(this.fetchSelectedMessages(),this.$nextTick(()=>{this.scrollToBottom()}))},5e3)},scrollToBottom(){const t=this.$refs.chatContainer;console.log(t),t&&(t.scrollTop=t.scrollHeight)},closeChat(){this.selectedMessageId=null},async submitContactForm(){this.loading=!0,this.form.post(route("contact-hr.store"),{onSuccess:()=>{this.loading=!1,this.form.reset(),u.fire({icon:"success",title:"Message Sent",text:"Your Message request has been submitted successfully!",confirmButtonColor:"#3085d6"})},onError:()=>{this.loading=!1,u.fire({icon:"error",title:"Failed",text:"Failed to send your message. Please try again."})}})},resetForm(){this.form={name:"",email:"",subject:"",message:""}},openChat(t){console.log("Opening chat with message:",t),this.selectedMessageId=t,this.fetchSelectedMessages(),this.$nextTick(()=>{this.scrollToBottom()});try{new bootstrap.Modal(document.getElementById("chatModal"),{keyboard:!0}).show()}catch(a){console.error("Error showing modal:",a)}},fetchSelectedMessages(){const t=this.allMessages.find(a=>a.id==this.selectedMessageId);console.log(t),this.selectedChat=t,this.prepareChat()},prepareChat(){const{replies:t=[],emp_replies:a=[]}=this.selectedChat;let c="";t&&(c=t.map(o=>({...o,timestamp:o.timestamp||new Date().toISOString()})));let b=a.map(o=>({...o,timestamp:o.timestamp||new Date().toISOString()}));this.formattedChat=[...c,...b].sort((o,l)=>new Date(o.timestamp)-new Date(l.timestamp))},async sendReply(){if(!this.replyMessage.trim()){u.fire({icon:"error",title:"Empty Reply",text:"Reply cannot be empty."});return}this.loading=!0;try{const t=await _.post(route("emplyee.reply",{id:this.selectedMessageId}),{reply:this.replyMessage});this.replyMessage="",u.fire({icon:"success",title:"Reply Sent",text:"Your reply has been sent successfully."}),this.loading=!1;const a=t.data.find(c=>c.id==this.selectedMessageId);Object.assign(this.selectedChat,a),this.prepareChat(),this.$nextTick(()=>{this.scrollToBottom()})}catch(t){console.error("Error sending message:",t)}},formatDate(t){return new Date(t).toLocaleString()}}},r=t=>(I("data-v-fce02081"),t=t(),E(),t),T={class:"bg-container py-5"},B={class:"container"},F={class:"card form-card mx-auto mb-4"},A=r(()=>e("div",{class:"card-header bg-gradient text-black"},[e("h3",{class:"mb-0"},"Contact HR"),e("p",{class:"mb-0"},"Feel free to send us your inquiries.")],-1)),V={class:"card-body"},q={class:"row mb-3"},N={class:"col-md-6 mb-3 mb-md-0"},H=r(()=>e("label",{for:"name",class:"form-label"},"Your Name",-1)),L={class:"col-md-6"},O=r(()=>e("label",{for:"email",class:"form-label"},"Your Weblook Email",-1)),U={class:"row mb-3"},Y={class:"col-12"},P=r(()=>e("label",{for:"subject",class:"form-label"},"Subject",-1)),z={class:"row mb-3"},G={class:"col-12"},J=r(()=>e("label",{for:"message",class:"form-label"},"Message",-1)),K={class:"row"},W={class:"col-12 text-end"},X=["disabled"],Q={key:0},Z=r(()=>e("i",{class:"spinner-border spinner-border-sm me-2"},null,-1)),$=j(" Submitting... "),ee=[Z,$],se={key:1},te={class:"card table-card mx-auto"},oe=r(()=>e("div",{class:"card-header bg-gradient-secondary text-black"},[e("h3",{class:"mb-0"},"Submitted Messages")],-1)),ae={class:"card-body"},le={class:"table-responsive"},re={class:"table table-striped table-bordered"},ne=r(()=>e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Subject"),e("th",null,"Message"),e("th",null,"Date"),e("th",null,"Action")])],-1)),ie=["onClick"],de={key:0},ce=r(()=>e("td",{colspan:"6",class:"text-center text-muted"},"No messages found.",-1)),me=[ce],he={key:0,class:"chat-section-wrapper"},ue={class:"card chat-card mx-auto mt-5"},pe={class:"card-header bg-gradient-info text-black d-flex justify-content-between"},be=r(()=>e("h3",{class:"mb-0"},"Chat with HR",-1)),_e={class:"card-body position-relative"},ge={key:0,class:"loading-overlay"},fe=r(()=>e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"})],-1)),ye=[fe],ve={class:"chat-history",ref:"chatContainer"},Me={class:"tag"},Ce={class:"bubble"},xe={class:"chat-message"},we={class:"chat-timestamp"},Se={class:"mb-3"},ke={class:"text-end"},Ie=["disabled"];function Ee(t,a,c,b,o,l){const M=w("AppLayout");return n(),S(M,null,{default:k(()=>[e("div",T,[e("div",B,[e("div",F,[A,e("div",V,[e("form",{onSubmit:a[4]||(a[4]=g((...s)=>l.submitContactForm&&l.submitContactForm(...s),["prevent"]))},[e("div",q,[e("div",N,[H,m(e("input",{type:"text",id:"name","onUpdate:modelValue":a[0]||(a[0]=s=>o.form.name=s),class:"form-control input-rounded",placeholder:"Enter your name",readonly:""},null,512),[[h,o.form.name]])]),e("div",L,[O,m(e("input",{type:"email",id:"email","onUpdate:modelValue":a[1]||(a[1]=s=>o.form.email=s),class:"form-control input-rounded",placeholder:"Enter your email",readonly:""},null,512),[[h,o.form.email]])])]),e("div",U,[e("div",Y,[P,m(e("input",{type:"text",id:"subject","onUpdate:modelValue":a[2]||(a[2]=s=>o.form.subject=s),class:"form-control input-rounded",placeholder:"Enter subject",required:""},null,512),[[h,o.form.subject]])])]),e("div",z,[e("div",G,[J,m(e("textarea",{id:"message","onUpdate:modelValue":a[3]||(a[3]=s=>o.form.message=s),class:"form-control input-rounded",rows:"4",placeholder:"Enter your message",required:""},null,512),[[h,o.form.message]])])]),e("div",K,[e("div",W,[e("button",{type:"submit",class:"btn btn-primary btn-rounded gradient-btn",disabled:o.loading||!o.form.subject||!o.form.message},[o.loading?(n(),i("span",Q,ee)):(n(),i("span",se,"Submit"))],8,X)])])],32)])]),e("div",te,[oe,e("div",ae,[e("div",le,[e("table",re,[ne,e("tbody",null,[(n(!0),i(y,null,f(o.allMessages,s=>(n(),i("tr",{key:s.id},[e("td",null,d(s.name),1),e("td",null,d(s.email),1),e("td",null,d(s.subject),1),e("td",null,d(s.message),1),e("td",null,d(l.formatDate(s.created_at)),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-primary",onClick:je=>l.openChat(s.id),"data-bs-toggle":"modal","data-bs-target":"#chatModal"},"Chat",8,ie)])]))),128)),o.allMessages.length===0?(n(),i("tr",de,me)):p("",!0)])])])])])]),o.selectedMessageId?(n(),i("div",he,[e("div",ue,[e("div",pe,[be,e("button",{onClick:a[5]||(a[5]=(...s)=>l.closeChat&&l.closeChat(...s)),class:"btn btn-danger btn-sm"},"X")]),e("div",_e,[o.loading?(n(),i("div",ge,ye)):p("",!0),e("div",ve,[(n(!0),i(y,null,f(o.formattedChat,s=>(n(),i("div",{key:s.timestamp,class:v(["d-flex align-items-start mb-3",s.from==="admin"?"admin-message":"employee-message"])},[e("div",{class:v(s.from==="admin"?"bubble-wrapper admin-bubble":"bubble-wrapper employee-bubble")},[e("div",Me,d(s.from==="admin"?"HR":""),1),e("div",Ce,[e("p",xe,d(s.message),1),e("small",we,d(l.formatDate(s.timestamp)),1)])],2)],2))),128))],512),e("form",{onSubmit:a[7]||(a[7]=g((...s)=>l.sendReply&&l.sendReply(...s),["prevent"]))},[e("div",Se,[m(e("textarea",{"onUpdate:modelValue":a[6]||(a[6]=s=>o.replyMessage=s),class:"form-control input-rounded",rows:"3",placeholder:"Type your reply...",required:""},null,512),[[h,o.replyMessage]])]),e("div",ke,[e("button",{type:"submit",class:"btn btn-success btn-rounded gradient-btn",disabled:o.loading}," Send Reply ",8,Ie)])],32)])])])):p("",!0)])]),_:1})}const Ae=R(D,[["render",Ee],["__scopeId","data-v-fce02081"]]);export{Ae as default};
